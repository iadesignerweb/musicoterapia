<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<title>WiFire Conecta</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.2/dist/socket.io.min.js"></script>

<style>
:root{
  --bg:#0f1113; --card:#15181b; --accent:#ff6b6b; --muted:#9aa3ad; --glass: rgba(255,255,255,0.03);
  --radius:12px; --sidebar-w:260px;
}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,Arial; margin:0; background:linear-gradient(180deg,#070809 0%, #0d0f10 100%); color:#e6eef3; -webkit-font-smoothing:antialiased;}
.wrap{display:flex; min-height:100vh;}

/* SIDEBAR */
.sidebar{width:var(--sidebar-w); background:linear-gradient(180deg,var(--card), #0c0e10); padding:18px; border-right:1px solid rgba(255,255,255,0.02); transition:transform .28s ease; z-index:50}
.sidebar.collapsed{transform:translateX(-110%);}
.brand{display:flex; gap:12px; align-items:center; margin-bottom:18px}
.logo{width:44px; height:44px; background:var(--accent); border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:700; color:#fff}
h1.logo-text{font-size:1.05rem; margin:0}
.nav{margin-top:6px; display:flex; flex-direction:column; gap:6px}
.nav button{background:transparent; border:none; color:var(--muted); text-align:left; padding:10px 12px; border-radius:8px; cursor:pointer; font-weight:600}
.nav button.active, .nav button:hover{color:#fff; background:linear-gradient(90deg, rgba(255,107,107,0.06), transparent)}
.sidebar .admin-info{margin-top:18px; font-size:0.9rem; color:var(--muted)}

/* MAIN */
.main{flex:1; padding:18px;}
.topbar{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px}
.search{background:var(--glass); padding:10px 14px; border-radius:10px; color:var(--muted); width:360px; max-width:60vw; border:1px solid rgba(255,255,255,0.02)}
.top-actions{display:flex; gap:10px; align-items:center}
.btn{background:var(--accent); color:#fff; border:none; padding:9px 14px; border-radius:10px; cursor:pointer; font-weight:700}
.card-row{display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:12px; margin-bottom:12px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px; border-radius:12px; box-shadow: 0 6px 18px rgba(0,0,0,0.45)}
.card h3{margin:0; font-size:0.95rem; color:var(--muted)}
.card .value{font-size:1.4rem; margin-top:6px}
.content-grid{display:grid; grid-template-columns: 1fr 380px; gap:12px; align-items:start}

/* Table */
table{width:100%; border-collapse:collapse; font-size:0.93rem}
th, td{padding:8px; text-align:left; color:var(--muted)}
th{font-weight:700; color:#fff; font-size:0.86rem}
.badge{padding:6px 8px; border-radius:999px; font-size:0.8rem}
.badge.active{background:rgba(72,187,120,0.12); color:#48bb78}
.badge.inactive{background:rgba(255,99,71,0.08); color:#ff6347}
.action-btn{background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); padding:6px 8px; border-radius:8px; cursor:pointer}

/* Chat */
.chat-box{background:linear-gradient(180deg,#0b0d0e,#0f1112); border-radius:12px; padding:12px; height:640px; display:flex; flex-direction:column}
.conversations{height:220px; overflow:auto; border-bottom:1px solid rgba(255,255,255,0.02); padding-bottom:8px}
.conv-item{display:flex; gap:10px; padding:10px; align-items:center; cursor:pointer; border-radius:8px}
.conv-item:hover{background:rgba(255,255,255,0.01)}
.avatar{width:44px;height:44px;border-radius:10px;background:#223;display:flex;align-items:center;justify-content:center;color:#fff}
.conv-meta{flex:1}
.messages{flex:1; overflow:auto; padding:10px; display:flex; flex-direction:column; gap:8px}
.msg{max-width:72%; padding:8px 12px; border-radius:12px}
.msg.user{align-self:flex-end; background:linear-gradient(90deg,#ff6b6b,#ff8e8e); color:#fff}
.msg.other{align-self:flex-start; background:rgba(255,255,255,0.03); color:var(--muted)}
.chat-input{display:flex; gap:8px; padding-top:10px}
.chat-input input{flex:1; padding:10px; border-radius:10px; border:none; background:var(--glass); color:#fff}
.small{font-size:0.85rem; color:var(--muted)}

/* modal */
.modal{position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:9999}
.modal-card{background:#0c0e10; padding:14px; border-radius:12px; width:420px}
.grid-cols-2{display:grid; grid-template-columns:1fr 1fr; gap:8px}

/* MOBILE FIXES */
@media (max-width:1000px){
  .content-grid{grid-template-columns:1fr}
  .chat-box{height:460px}
  .sidebar{position:fixed; left:0; top:0; bottom:0; z-index:90}
}
@media (max-width:700px){
  .wrap{flex-direction:column}
  .sidebar{position:fixed; top:0; left:0; height:100vh; transform:translateX(-110%); width:80%; max-width:320px}
  .sidebar.open{transform:translateX(0)}
  .main{padding:12px}
  .topbar{gap:8px}
  .search{width:100%}
  .card-row{grid-template-columns: repeat(2, 1fr); gap:10px}
  .card .value{font-size:1.1rem}
  .btn{padding:8px 10px}
  .card{padding:12px}
}
/* mobile hamburger */
.mobile-toggle{display:none}
@media (max-width:700px){ .mobile-toggle{display:inline-flex; align-items:center; gap:8px; padding:8px; background:transparent; border-radius:8px; border:1px solid rgba(255,255,255,0.03); color:var(--muted)} }

/* CUSTOM STYLES */
#landingPage, #adminPanel {
  min-height: 100vh;
  display: flex;
}
#landingPage {
  background: linear-gradient(180deg,#070809 0%, #0d0f10 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  color: #e6eef3;
  text-align: center;
  padding: 20px;
  box-sizing: border-box;
}
.landing-container {
    background: #15181b;
    padding: 30px;
    border-radius: 10px;
    max-width: 400px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.45);
}
.landing-content h1 {
    font-size: 2.5rem;
    color: var(--accent);
}
.landing-content p {
    font-size: 1.2rem;
    line-height: 1.6;
    margin-bottom: 20px;
}
.user-login-form h3 {
    font-size: 1.2rem;
    margin-top: 0;
}
.user-login-form input {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
    background: var(--glass);
    color: #fff;
    margin-top: 10px;
}
.user-login-form .btn {
    margin-top: 15px;
    width: 100%;
}

.modal-login {
  background: rgba(0,0,0,0.8);
}
.modal-card {
  background: #15181b;
}

</style>
</head>
<body>

<div id="appContainer">
  <div class="wrap" id="adminPanel" style="display:none;">
    
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo">WiF</div>
        <div>
          <h1 class="logo-text">WiFire Conecta</h1>
          <div class="small">Painel Administrativo</div>
        </div>
      </div>

      <nav class="nav" id="menuNav">
        <button class="active" data-view="dashboard">Dashboard</button>
        <button data-view="users">Usuários</button>
        <button data-view="chat">Chat de Pedidos <span id="notiBadge" style="float:right;background:#ff4d4d;padding:3px 6px;border-radius:8px;color:#fff;font-size:0.8rem;display:none">0</span></button>
        <button data-view="settings">Configurações</button>
      </nav>

      <div class="admin-info">
        <div style="margin-top:14px">Logado como: <strong id="adminName">Administrador</strong></div>
        <div class="small" style="margin-top:10px">Último login: <span id="lastLogin">--</span></div>
        <div style="margin-top:12px">
          <button class="action-btn" onclick="logout()">Sair</button>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div style="display:flex; gap:12px; align-items:center;">
          <button class="mobile-toggle" id="toggleSidebarBtn" onclick="toggleSidebar()">☰ Menu</button>
          <input id="searchInput" class="search" placeholder="Pesquisar usuário, número ou pedido..." />
        </div>
        <div class="top-actions">
          <div class="small">Ambiente: <strong>Produção</strong></div>
          <button class="btn" onclick="openNewUser()">Novo Usuário</button>
        </div>
      </div>

      <section id="view-dashboard" class="view">
        <div class="card-row">
          <div class="card">
            <h3>Usuários Ativos</h3>
            <div class="value" id="statActive">0</div>
            <div class="small">Usuários com sessão ativa nas últimas 24h</div>
          </div>
          <div class="card">
            <h3>Assinaturas Ativas</h3>
            <div class="value" id="statSubs">0</div>
            <div class="small">Planos ativos</div>
          </div>
          <div class="card">
            <h3>Mensagens (hoje)</h3>
            <div class="value" id="statMsgs">0</div>
            <div class="small">Mensagens trocadas</div>
          </div>
          <div class="card">
            <h3>Novos Cadastros (7d)</h3>
            <div class="value" id="statNew">0</div>
            <div class="small">Crescimento semanal</div>
          </div>
        </div>

        <div class="content-grid">
          <div class="card">
            <h3>Atividade</h3>
            <canvas id="chartActivity" height="160"></canvas>
          </div>

          <aside class="card">
            <h3>Resumo Rápido</h3>
            <div style="margin-top:10px">
              <div class="small">Total usuários: <strong id="totalUsers">0</strong></div>
              <div class="small" style="margin-top:8px">Planos: <strong id="planSummary">—</strong></div>
              <div class="small" style="margin-top:8px">Mensagens totais: <strong id="totalMsgs">0</strong></div>
              <div style="margin-top:12px">
                <button class="btn" onclick="syncWithBackend()">Sincronizar (Socket/API)</button>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <section id="view-users" class="view" style="display:none;">
        <div class="card">
            <h3>Usuários Cadastrados</h3>
            <div style="overflow:auto; margin-top:10px">
                <table id="usersTable">
                    <thead><tr><th>Nome</th><th>Nº</th><th>Plano</th><th>Status</th><th>Ações</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <div class="card" style="margin-top:20px;">
            <h3>Solicitações Pendentes</h3>
            <div style="overflow:auto; margin-top:10px">
                <table id="pendingUsersTable">
                    <thead><tr><th>Nome</th><th>Nº</th><th>Ações</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
      </section>

      <section id="view-subscriptions" class="view" style="display:none">
        <div class="card">
          <h3>Controle de Assinaturas</h3>
          <div style="margin-top:10px" id="subsList"></div>
        </div>
      </section>

      <section id="view-chat" class="view" style="display:none">
        <div class="card" style="padding:12px; display:flex; gap:12px; flex-direction:column;">
          <div style="display:flex; gap:12px; flex-direction:row; align-items:flex-start;">
            <div style="width:280px">
              <h3>Conversas</h3>
              <div class="conversations" id="conversationsList"></div>
            </div>
            <div style="flex:1; display:flex; flex-direction:column;">
              <h3 id="chatTitle">Selecione uma conversa</h3>
              <div class="chat-box" style="margin-top:8px">
                <div class="messages" id="messagesArea"></div>
                <div class="chat-input">
                  <input id="chatInput" placeholder="Digite a mensagem..." />
                  <button class="btn" onclick="sendMessage()">Enviar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="view-settings" class="view" style="display:none">
        <div class="card">
          <h3>Configurações</h3>
          <div style="margin-top:12px" class="grid-cols-2">
            <div>
              <label class="small">Senha Admin</label>
              <input id="adminPasswordInput" placeholder="wifire2025" style="width:100%; padding:8px; border-radius:8px; border:none; background:var(--glass); color:#fff" />
            </div>
            <div>
              <label class="small">Endpoint Socket (bot/server)</label>
              <input id="socketEndpoint" placeholder="http(s)://seu-bot:PORT" style="width:100%; padding:8px; border-radius:8px; border:none; background:var(--glass); color:#fff" />
            </div>
          </div>
          <div style="margin-top:12px">
            <button class="btn" onclick="saveSettings()">Salvar Configurações</button>
            <button class="action-btn" onclick="tryConnectSocket()" style="margin-left:8px">Conectar Socket</button>
          </div>
          <div class="small" style="margin-top:8px; color:var(--muted)">Dica: use o endereço do seu WiFire-bot (ex: https://ip:3000)</div>
        </div>
      </section>
    </main>
  </div>
  
  <div id="adminLoginModal" class="modal" style="display:none;">
    <div class="modal-card">
      <h2 style="color:var(--accent); margin:0 0 12px 0">Login Administrativo</h2>
      <div style="margin-bottom:8px" class="small">Digite a senha para acessar o painel</div>
      <input id="adminInput" placeholder="Senha" type="password" style="width:100%; padding:10px; border-radius:8px; border:none; background:var(--glass); color:#fff" />
      <div id="loginError" style="color:#ff6b6b; margin-top:8px; display:none"></div>
      <div style="margin-top:12px; display:flex; gap:8px">
        <button class="btn" onclick="login()">Entrar</button>
        <a href="index.html" class="action-btn">Voltar</a>
      </div>
      <div class="small" style="margin-top:10px; color:var(--muted)">Senha padrão: <strong>wifire2025</strong></div>
    </div>
  </div>

  <div id="newUserModal" class="modal" style="display:none">
    <div class="modal-card">
      <h3>Novo Usuário</h3>
      <div style="margin-top:10px" class="grid-cols-2">
        <input id="nuName" placeholder="Nome" />
        <input id="nuNumber" placeholder="Número" />
      </div>
      <div style="margin-top:10px" class="grid-cols-2">
        <select id="nuPlan">
          <option value="gratuito">Gratuito</option>
          <option value="mensal">Mensal</option>
          <option value="anual">Anual</option>
        </select>
        <select id="nuStatus">
          <option value="active">Ativo</option>
          <option value="inactive">Inativo</option>
        </select>
      </div>
      <div style="margin-top:12px; text-align:right">
        <button class="action-btn" onclick="closeNewUser()">Cancelar</button>
        <button class="btn" onclick="createUser()">Criar</button>
      </div>
    </div>
  </div>

  <div id="userProfileModal" class="modal" style="display:none">
    <div class="modal-card">
      <h3 id="profileName">Carregando...</h3>
      <div style="margin-top:12px; font-size:0.9rem">
        <div><strong>Nº:</strong> <span id="profileNumber">--</span></div>
        <div style="margin-top:6px"><strong>Plano:</strong> <span id="profilePlan">--</span></div>
        <div style="margin-top:6px"><strong>Status:</strong> <span id="profileStatus">--</span></div>
        <div style="margin-top:6px"><strong>Cadastro:</strong> <span id="profileCreated">--</span></div>
      </div>
      <div style="margin-top:16px; text-align:right">
        <button class="action-btn" onclick="closeUserProfile()">Fechar</button>
      </div>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
