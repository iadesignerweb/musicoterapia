<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<title>WiFire Conecta</title>
<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.7.2/dist/socket.io.min.js"></script>

</head>
<body>

<div id="appContainer">
  <div class="wrap" id="adminPanel" style="display:none;">
    
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo">WiF</div>
        <div>
          <h1 class="logo-text">WiFire Conecta</h1>
          <div class="small">Painel Administrativo</div>
        </div>
      </div>

      <nav class="nav" id="menuNav">
        <button class="active" data-view="dashboard">Dashboard</button>
        <button data-view="users">Usuários</button>
        <button data-view="subscriptions">Assinaturas</button>
        <button data-view="chat">Chat de Pedidos <span id="notiBadge" style="float:right;background:#ff4d4d;padding:3px 6px;border-radius:8px;color:#fff;font-size:0.8rem;display:none">0</span></button>
        <button data-view="settings">Configurações</button>
      </nav>

      <div class="admin-info">
        <div style="margin-top:14px">Logado como: <strong id="adminName">Administrador</strong></div>
        <div class="small" style="margin-top:10px">Último login: <span id="lastLogin">--</span></div>
        <div style="margin-top:12px">
          <button class="action-btn" onclick="logout()">Sair</button>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div style="display:flex; gap:12px; align-items:center;">
          <button class="mobile-toggle" id="toggleSidebarBtn" onclick="toggleSidebar()">☰ Menu</button>
          <input id="searchInput" class="search" placeholder="Pesquisar usuário, número ou pedido..." />
        </div>
        <div class="top-actions">
          <div class="small">Ambiente: <strong>Produção</strong></div>
          <button class="btn" onclick="openNewUser()">Novo Usuário</button>
        </div>
      </div>

      <section id="view-dashboard" class="view">
        <div class="card-row">
          <div class="card">
            <h3>Usuários Ativos</h3>
            <div class="value" id="statActive">0</div>
            <div class="small">Usuários com sessão ativa nas últimas 24h</div>
          </div>
          <div class="card">
            <h3>Assinaturas Ativas</h3>
            <div class="value" id="statSubs">0</div>
            <div class="small">Planos ativos</div>
          </div>
          <div class="card">
            <h3>Mensagens (hoje)</h3>
            <div class="value" id="statMsgs">0</div>
            <div class="small">Mensagens trocadas</div>
          </div>
          <div class="card">
            <h3>Novos Cadastros (7d)</h3>
            <div class="value" id="statNew">0</div>
            <div class="small">Crescimento semanal</div>
          </div>
        </div>

        <div class="content-grid">
          <div class="card">
            <h3>Atividade</h3>
            <canvas id="chartActivity" height="160"></canvas>
          </div>

          <aside class="card">
            <h3>Resumo Rápido</h3>
            <div style="margin-top:10px">
              <div class="small">Total usuários: <strong id="totalUsers">0</strong></div>
              <div class="small" style="margin-top:8px">Planos: <strong id="planSummary">—</strong></div>
              <div class="small" style="margin-top:8px">Mensagens totais: <strong id="totalMsgs">0</strong></div>
              <div style="margin-top:12px">
                <button class="btn" onclick="syncWithBackend()">Sincronizar (Socket/API)</button>
              </div>
            </div>
          </aside>
        </div>
      </section>

      <section id="view-users" class="view" style="display:none">
        <div class="card">
          <h3>Usuários Cadastrados</h3>
          <div style="overflow:auto; margin-top:10px">
            <table id="usersTable">
              <thead><tr><th>Nome</th><th>Nº</th><th>Plano</th><th>Status</th><th>Ações</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="view-subscriptions" class="view" style="display:none">
        <div class="card">
          <h3>Controle de Assinaturas</h3>
          <div style="margin-top:10px" id="subsList"></div>
        </div>
      </section>

      <section id="view-chat" class="view" style="display:none">
        <div class="card" style="padding:12px; display:flex; gap:12px; flex-direction:column;">
          <div style="display:flex; gap:12px; flex-direction:row; align-items:flex-start;">
            <div style="width:280px">
              <h3>Conversas</h3>
              <div class="conversations" id="conversationsList"></div>
            </div>
            <div style="flex:1; display:flex; flex-direction:column;">
              <h3 id="chatTitle">Selecione uma conversa</h3>
              <div class="chat-box" style="margin-top:8px">
                <div class="messages" id="messagesArea"></div>
                <div class="chat-input">
                  <input id="chatInput" placeholder="Digite a mensagem..." />
                  <button class="btn" onclick="sendMessage()">Enviar</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="view-settings" class="view" style="display:none">
        <div class="card">
          <h3>Configurações</h3>
          <div style="margin-top:12px" class="grid-cols-2">
            <div>
              <label class="small">Senha Admin</label>
              <input id="adminPasswordInput" placeholder="wifire2025" style="width:100%; padding:8px; border-radius:8px; border:none; background:var(--glass); color:#fff" />
            </div>
            <div>
              <label class="small">Endpoint Socket (bot/server)</label>
              <input id="socketEndpoint" placeholder="http(s)://seu-bot:PORT" style="width:100%; padding:8px; border-radius:8px; border:none; background:var(--glass); color:#fff" />
            </div>
          </div>
          <div style="margin-top:12px">
            <button class="btn" onclick="saveSettings()">Salvar Configurações</button>
            <button class="action-btn" onclick="tryConnectSocket()" style="margin-left:8px">Conectar Socket</button>
          </div>
          <div class="small" style="margin-top:8px; color:var(--muted)">Dica: use o endereço do seu WiFire-bot (ex: https://ip:3000)</div>
        </div>
      </section>
    </main>
  </div>
  
  <div id="userLanding" style="display:flex;">
    <div class="landing-container">
      <h1>WiFire Conecta</h1>
      <p>Bem-vindo ao nosso Hotspot Social! Conecte-se para ter acesso Wi-Fi grátis e seguro.</p>
      <div class="login-form">
        <input type="text" id="userName" placeholder="Seu Nome" />
        <input type="tel" id="userPhone" placeholder="Seu WhatsApp (apenas números)" />
        <button class="btn" onclick="userLogin()">Conectar</button>
      </div>
      <div class="admin-link">
        <a href="#" onclick="showAdminLogin()">Acesso Administrativo</a>
      </div>
    </div>
  </div>

  <div id="adminLoginModal" class="modal" style="display:none">
    <div class="modal-card">
      <h2 style="color:var(--accent); margin:0 0 12px 0">Login Administrativo</h2>
      <div style="margin-bottom:8px" class="small">Digite a senha para acessar o painel</div>
      <input id="adminInput" placeholder="Senha" type="password" style="width:100%; padding:10px; border-radius:8px; border:none; background:var(--glass); color:#fff" />
      <div id="loginError" style="color:#ff6b6b; margin-top:8px; display:none"></div>
      <div style="margin-top:12px; display:flex; gap:8px">
        <button class="btn" onclick="login()">Entrar</button>
        <button class="action-btn" onclick="hideAdminLogin()">Voltar</button>
      </div>
      <div class="small" style="margin-top:10px; color:var(--muted)">Senha padrão: <strong>wifire2025</strong></div>
    </div>
  </div>

  <div id="newUserModal" class="modal" style="display:none">
    <div class="modal-card">
      <h3>Novo Usuário</h3>
      <div style="margin-top:10px" class="grid-cols-2">
        <input id="nuName" placeholder="Nome" />
        <input id="nuNumber" placeholder="Número" />
      </div>
      <div style="margin-top:10px" class="grid-cols-2">
        <select id="nuPlan">
          <option value="gratuito">Gratuito</option>
          <option value="mensal">Mensal</option>
          <option value="anual">Anual</option>
        </select>
        <select id="nuStatus">
          <option value="active">Ativo</option>
          <option value="inactive">Inativo</option>
        </select>
      </div>
      <div style="margin-top:12px; text-align:right">
        <button class="action-btn" onclick="closeNewUser()">Cancelar</button>
        <button class="btn" onclick="createUser()">Criar</button>
      </div>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
